# 火车票大作业

## 0516

哈希相关：

用户名：哈希到在文件中的位置

车次名：同上

站名：直接哈希

Outline

#### 用户：

（≤一万个用户 in **文件01**，每次读进内存，最后写回文件）

- `username`：用户的唯一标识符，由字母开头，字母、数字和下划线组成的字符串，长度不超过20。
- `password`：由字母、数字和下划线组成的字符串，长度不低于6，不超过30。
- `name`：由二至五个汉字组成的字符串。
- `mailAddr`：同一般邮箱地址格式，且仅含数字、大小写字母，`@`和`.`，长度不超过30。（无需检验邮箱格式的合法性）
- `privilege`：所处用户组优先级，为一个0~10的整数。
- `order`：订单信息（具体见下）
  - 在末尾加
  - 在当中删
    - 更改订单状态
    - 调整候补问题



#### 订单：

（**文件02** B+树维护）

- 第一关键字：用户`username`
- 第二关键字：订单ID`orderID`

（**文件03** 订单信息，即B+树叶子为订单编号，编号在该文件对应具体信息）

- 订单ID
- ->订单信息（时间、车次、从哪到哪、状态）

相关操作：退票后提上候补（暴力）

维护**候补信息**：

（**文件04** B+树维护）

- 车次
- 日期



#### （发布前）车次：

（**文件05**）

- `trainID`：车次的唯一标识符，由字母开头，字母、数字和下划线组成的字符串，长度不超过20。

- `stationNum`：车次经过的车站数量，为不超过100的整数。

- `stations`：车次经过的所有车站名，共`stationNum`项，站名由汉字组成，不超过10个汉字。

  格式为：`station_1 station_2 station_3 ... station_stationNum`

- `seatNum`：该车次的座位数，为不超过100000的整数。

- `prices`：每两站之间的票价，共`(stationNum - 1)`项，第`i`项表示`station_i`到`station_(i+1)`的票价，是一个不超过100000的整数。

  格式为：`price_1 price_2 price_3 ... price_(stationNum - 1)`

- `startTime`：列车每日的发车时间，时间格式为`hr:mi`。如：`23:51`。

- `travelTimes`：每两站之间行车所用的时间（单位为分钟），共`(stationNum - 1)`项，每一项是一个不超过10000的整数。

- `stopoverTimes`：除始发站和终点站之外，列车在每一站停留的时间（单位为分钟），共`(stationNum - 2)`项，每一项是一个不超过10000的整数。

- `saleDate`：车次的售卖时间区间（闭区间），在时间区间内，每天都有相同的此车次。共2项，每一项均为2020年6月至8月的某一天，日期格式为`mm-dd`。如：`06-07`。

- `type`：列车类型，为一个大写字母。

可加/删/发布

**发布前车次索引**

（**文件06**）

- 车次ID
- ->在文件05中的位置



#### （发布后）车次：

（**文件07** ≤10000条，所以直接一开始读入内存）

- 车次信息（见上）
- 余票信息在文件07里的位置

**发布后车次索引**

（**文件08**）

- 车次ID
- ->在文件07中的位置



**余票信息**

（**文件09** 数组线性存储）

- 发车日期
- 所有余票信息
- 数量级：10000 * 100 * 100
- 存储：in磁盘
- 维护：每次发车（车票x售卖区间）开一个数据结构

query_ticket

1. 起始站&结束站求交
2. 对日期做核验
3. 时间/价格排序：前缀和

（**文件10** B+树）

- key：起始站站名 经过该站的车次

- value：该站为该车次的第几站

query_transfer

1. 获得出发日期+经过始发站的所有可用车次

2. 找到这些车次对应的所有车站
3. 根据这些车站和终点站查票

buy_ticket & refund_ticket

1. 修改订单信息
2. 修改余票信息



## 0520